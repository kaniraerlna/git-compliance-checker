<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Git Compliance Checker Demo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .tab-button {
            transition: all 0.3s ease;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="min-h-screen p-8">
        <div class="max-w-3xl mx-auto">
            <!-- Header -->
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-800 mb-2 flex items-center justify-center gap-3">
                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <circle cx="12" cy="12" r="3"></circle>
                        <line x1="12" y1="1" x2="12" y2="9"></line>
                        <line x1="12" y1="15" x2="12" y2="23"></line>
                    </svg>
                    Git Compliance Checker
                </h1>
                <p class="text-gray-600">Sistem monitoring compliance untuk commit & merge request</p>
            </div>

            <!-- Tabs -->
            <div class="bg-white rounded-t-lg shadow-sm border border-gray-200 border-b-0 overflow-hidden">
                <div class="flex">
                    <button id="commitTab" class="tab-button flex-1 py-4 px-6 font-semibold flex items-center justify-center gap-2 bg-blue-600 text-white">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <circle cx="12" cy="12" r="3"></circle>
                            <line x1="12" y1="1" x2="12" y2="9"></line>
                        </svg>
                        Commit Checker
                    </button>
                    <button id="mrTab" class="tab-button flex-1 py-4 px-6 font-semibold flex items-center justify-center gap-2 bg-gray-50 text-gray-600 hover:bg-gray-100">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <circle cx="18" cy="18" r="3"></circle>
                            <circle cx="6" cy="6" r="3"></circle>
                            <path d="M6 21V9a9 9 0 0 0 9 9"></path>
                        </svg>
                        Merge Request Checker
                    </button>
                </div>
            </div>

            <!-- Content -->
            <div class="bg-white rounded-b-lg shadow-sm border border-gray-200 p-6">
                <!-- Commit Tab Content -->
                <div id="commitContent">
                    <textarea
                        id="commitTitle"
                        placeholder="feat: Add new feature (Taiga #PROJECT-123)"
                        rows="3"
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg text-gray-800 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"
                    ></textarea>

                    <button
                        id="validateCommitBtn"
                        class="w-full mt-4 bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 rounded-lg transition-colors"
                    >
                        Validasi Title
                    </button>

                    <div class="mt-4 bg-gray-50 rounded-lg border border-gray-200 p-5">
                        <h3 class="font-semibold text-gray-800 mb-3">Format Standard:</h3>
                        <div class="bg-white border border-gray-300 rounded px-3 py-2 mb-4">
                            <code class="text-sm text-gray-700">&lt;tipe&gt;: &lt;ringkasan&gt; (Taiga #&lt;Project&gt;-&lt;Ticket&gt;)</code>
                        </div>
                        <div class="text-sm text-gray-600">
                            <span class="font-medium">Tipe:</span> feat, fix, refactor, docs, style, test, chore, perf, ci, build, revert
                        </div>
                    </div>

                    <div id="commitResult" class="mt-4"></div>

                    <div class="mt-6 bg-blue-50 rounded-lg border border-blue-200 p-5">
                        <h3 class="text-sm font-semibold text-blue-900 mb-3">Contoh Valid:</h3>
                        <div class="space-y-2">
                            <button class="example-btn block w-full text-left px-3 py-2 bg-white border border-blue-200 rounded hover:bg-blue-50 transition-colors text-sm text-gray-700" data-example="feat: Add user authentication system (Taiga #PROJECT-123)">
                                <code>feat: Add user authentication system (Taiga #PROJECT-123)</code>
                            </button>
                            <button class="example-btn block w-full text-left px-3 py-2 bg-white border border-blue-200 rounded hover:bg-blue-50 transition-colors text-sm text-gray-700" data-example="fix: Resolve memory leak in worker service (Taiga #CORE-456)">
                                <code>fix: Resolve memory leak in worker service (Taiga #CORE-456)</code>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- MR Tab Content -->
                <div id="mrContent" class="hidden">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Merge Request Title
                        </label>
                        <textarea
                            id="mrTitle"
                            placeholder="fix: Perbaiki bug login (Taiga #DATB-456)"
                            rows="3"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg text-gray-800 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"
                        ></textarea>
                    </div>

                    <div class="mt-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            MR Reference Extraction
                        </label>
                        <textarea
                            id="mrDescription"
                            placeholder="Ticket Link: [(Taiga #DATB-456)](https://...)"
                            rows="6"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg text-gray-800 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono text-sm"
                        ></textarea>
                        <button id="useExampleDesc" class="mt-2 text-sm text-blue-600 hover:text-blue-700 font-medium">
                            Use example description
                        </button>
                    </div>

                    <button
                        id="validateMRBtn"
                        class="w-full mt-4 bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 rounded-lg transition-colors"
                    >
                        Validasi Title
                    </button>

                    <div class="mt-4 bg-gray-50 rounded-lg border border-gray-200 p-5">
                        <h3 class="font-semibold text-gray-800 mb-3">Format Standard:</h3>
                        <div class="bg-white border border-gray-300 rounded px-3 py-2 mb-4">
                            <code class="text-sm text-gray-700">&lt;tipe&gt;: &lt;ringkasan&gt; (Taiga #&lt;Project&gt;-&lt;Ticket&gt;)</code>
                        </div>
                        <div class="text-sm text-gray-600">
                            <span class="font-medium">Tipe:</span> feat, fix, refactor, docs, style, test, chore, perf, ci, build, revert
                        </div>
                    </div>

                    <div id="mrResult" class="mt-4"></div>
                </div>
            </div>

            <!-- Valid Types Reference -->
            <!-- <div class="mt-6 bg-white rounded-lg shadow-sm border border-gray-200 p-5">
                <h3 class="text-sm font-semibold text-gray-800 mb-3">Valid Commit Types</h3>
                <div class="flex flex-wrap gap-2">
                    <span class="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-mono border border-gray-200">feat</span>
                    <span class="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-mono border border-gray-200">fix</span>
                    <span class="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-mono border border-gray-200">refactor</span>
                    <span class="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-mono border border-gray-200">docs</span>
                    <span class="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-mono border border-gray-200">style</span>
                    <span class="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-mono border border-gray-200">test</span>
                    <span class="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-mono border border-gray-200">chore</span>
                    <span class="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-mono border border-gray-200">perf</span>
                    <span class="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-mono border border-gray-200">ci</span>
                    <span class="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-mono border border-gray-200">build</span>
                    <span class="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-mono border border-gray-200">revert</span>
                </div>
            </div> -->
        </div>
    </div>

    <script>
        const VALID_TYPES = ['feat', 'fix', 'refactor', 'docs', 'style', 'test', 'chore', 'perf', 'ci', 'build', 'revert'];
        
        let currentSuggestion = '';
        let currentTab = 'commit';

        // Tab switching
        document.getElementById('commitTab').addEventListener('click', () => {
            switchTab('commit');
        });

        document.getElementById('mrTab').addEventListener('click', () => {
            switchTab('mr');
        });

        function switchTab(tab) {
            currentTab = tab;
            
            if (tab === 'commit') {
                document.getElementById('commitContent').classList.remove('hidden');
                document.getElementById('mrContent').classList.add('hidden');
                document.getElementById('commitTab').classList.remove('bg-gray-50', 'text-gray-600', 'hover:bg-gray-100');
                document.getElementById('commitTab').classList.add('bg-blue-600', 'text-white');
                document.getElementById('mrTab').classList.remove('bg-blue-600', 'text-white');
                document.getElementById('mrTab').classList.add('bg-gray-50', 'text-gray-600', 'hover:bg-gray-100');
            } else {
                document.getElementById('commitContent').classList.add('hidden');
                document.getElementById('mrContent').classList.remove('hidden');
                document.getElementById('mrTab').classList.remove('bg-gray-50', 'text-gray-600', 'hover:bg-gray-100');
                document.getElementById('mrTab').classList.add('bg-blue-600', 'text-white');
                document.getElementById('commitTab').classList.remove('bg-blue-600', 'text-white');
                document.getElementById('commitTab').classList.add('bg-gray-50', 'text-gray-600', 'hover:bg-gray-100');
            }
        }

        // Validation logic
        function checkCompliance(titleText) {
            const errors = [];
            let parsedData = null;
            let generatedSuggestion = '';

            if (!titleText || !titleText.trim()) {
                errors.push("Format tidak sesuai dengan standar: <tipe>: <ringkasan> (Taiga #<NamaProject>-<NomorTicket>)");
                generatedSuggestion = "feat: [Deskripsi perubahan Anda] (Taiga #PROJECT-123)";
                return { isValid: false, errors, suggestion: generatedSuggestion, parsedData };
            }

            const titlePattern = /^([a-z]+):\s+(.+?)\s+\(Taiga\s+#([A-Z0-9]+)-(\d+)\)$/i;
            const match = titleText.trim().match(titlePattern);

            if (!match) {
                const typeMatch = titleText.match(/^([a-z]+):/i);
                let suggestedType = 'feat';
                let suggestedSummary = titleText.replace(/^[a-z]+:\s*/i, '').trim();
                
                if (typeMatch) {
                    const usedType = typeMatch[1].toLowerCase();
                    if (VALID_TYPES.includes(usedType)) {
                        suggestedType = usedType;
                    }
                    suggestedSummary = titleText.replace(/^[a-z]+:\s*/i, '').trim();
                } else {
                    suggestedSummary = titleText.trim();
                }

                suggestedSummary = suggestedSummary.replace(/\(.*?#.*?\)/g, '').trim();
                suggestedSummary = suggestedSummary.replace(/\s+/g, ' ').trim();
                
                if (!suggestedSummary || suggestedSummary.length < 10) {
                    suggestedSummary = "Add new feature";
                }

                generatedSuggestion = `${suggestedType}: ${suggestedSummary} (Taiga #PROJECT-123)`;
                errors.push(`Format tidak sesuai dengan standar: <tipe>: <ringkasan> (Taiga #<NamaProject>-<NomorTicket>)`);
                
                return { isValid: false, errors, suggestion: generatedSuggestion, parsedData };
            }

            parsedData = {
                type: match[1],
                summary: match[2],
                project: match[3],
                ticket: match[4]
            };

            const commitType = parsedData.type.toLowerCase();
            if (!VALID_TYPES.includes(commitType)) {
                errors.push(`Tipe commit '${commitType}' tidak valid`);
                generatedSuggestion = `feat: ${parsedData.summary} (Taiga #${parsedData.project}-${parsedData.ticket})`;
                return { isValid: false, errors, suggestion: generatedSuggestion, parsedData };
            }

            const summary = parsedData.summary.trim();
            if (summary.length < 10) {
                errors.push("Ringkasan terlalu pendek (minimal 10 karakter)");
                generatedSuggestion = `${commitType}: ${summary} with more details (Taiga #${parsedData.project}-${parsedData.ticket})`;
            }
            if (summary.length > 100) {
                errors.push("Ringkasan terlalu panjang (maksimal 100 karakter)");
                generatedSuggestion = `${commitType}: ${summary.substring(0, 80)}... (Taiga #${parsedData.project}-${parsedData.ticket})`;
            }

            if (errors.length > 0) {
                return { isValid: false, errors, suggestion: generatedSuggestion, parsedData };
            }

            return { isValid: true, errors: [], suggestion: '', parsedData };
        }

        function extractLinks(description) {
            if (!description) return { ticket: null, documentation: null, testing: null };

            const ticketMatch = description.match(/Ticket\s+Link:\s*\[(?:[^\]]+)\]\((https?:\/\/[^\)]+)\)/i);
            const docMatch = description.match(/Documentation\s+Link:\s*\[(?:[^\]]+)\]\((https?:\/\/[^\)]+)\)/i);
            const testMatch = description.match(/Testing\s+Link:\s*\[(https?:\/\/[^\]]+)\]/i);

            return {
                ticket: ticketMatch ? ticketMatch[1] : null,
                documentation: docMatch ? docMatch[1] : null,
                testing: testMatch ? testMatch[1] : null
            };
        }

        function renderResultBox(result, containerId) {
            const container = document.getElementById(containerId);
            
            const borderColor = result.isValid ? 'border-green-500' : 'border-red-500';
            const bgColor = result.isValid ? 'bg-green-50' : 'bg-red-50';
            const textColor = result.isValid ? 'text-green-800' : 'text-red-800';
            const iconColor = result.isValid ? 'text-green-600' : 'text-red-600';
            const icon = result.isValid 
                ? '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>'
                : '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>';
            
            let html = `
                <div class="rounded-lg border-2 overflow-hidden bg-white ${borderColor}">
                    <div class="px-5 py-3 flex items-center gap-3 ${bgColor}">
                        <div class="${iconColor}">${icon}</div>
                        <span class="font-semibold ${textColor}">${result.isValid ? 'Valid ✓' : 'Invalid ✗'}</span>
                    </div>
                    <div class="p-5">
            `;

            if (result.isValid && result.parsedData) {
                html += `
                    <div class="space-y-2 text-gray-700">
                        <p><span class="font-medium">Tipe:</span> ${result.parsedData.type}</p>
                        <p><span class="font-medium">Ringkasan:</span> ${result.parsedData.summary}</p>
                        <p><span class="font-medium">Project:</span> ${result.parsedData.project}</p>
                        <p><span class="font-medium">Ticket:</span> ${result.parsedData.ticket}</p>
                    </div>
                `;
            }

            if (!result.isValid) {
                html += '<div class="space-y-4">';
                
                if (result.errors.length > 0) {
                    html += '<div><ul class="space-y-2 text-red-700">';
                    result.errors.forEach(error => {
                        html += `<li class="flex gap-2"><span>•</span><span>${error}</span></li>`;
                    });
                    html += '</ul></div>';
                }

                if (result.suggestion) {
                    currentSuggestion = result.suggestion;
                    html += `
                        <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
                            <div class="flex items-start gap-2 mb-3">
                                <svg class="w-4 h-4 text-blue-600 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <p class="text-sm font-medium text-gray-700">Saran perbaikan:</p>
                            </div>
                            <div class="bg-white border border-gray-300 rounded px-3 py-2 mb-3">
                                <code class="text-sm text-blue-600">${result.suggestion}</code>
                            </div>
                            <button id="useSuggestionBtn" class="text-sm text-blue-600 hover:text-blue-700 font-medium hover:underline">
                                Gunakan Saran
                            </button>
                        </div>
                    `;
                }
                
                html += '</div>';
            }

            html += '</div></div>';
            container.innerHTML = html;

            // Add event listener for suggestion button
            const suggestionBtn = document.getElementById('useSuggestionBtn');
            if (suggestionBtn) {
                suggestionBtn.addEventListener('click', () => {
                    if (currentTab === 'commit') {
                        document.getElementById('commitTitle').value = currentSuggestion;
                        document.getElementById('commitResult').innerHTML = '';
                    } else {
                        document.getElementById('mrTitle').value = currentSuggestion;
                        document.getElementById('mrResult').innerHTML = '';
                    }
                });
            }
        }

        function renderLinksBox(links) {
            if (!links.ticket && !links.documentation && !links.testing) {
                return '';
            }

            let html = `
                <div class="mt-4 bg-gray-50 rounded-lg border border-gray-200 p-5">
                    <h4 class="font-semibold text-gray-800 mb-3 flex items-center gap-2">
                        <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path>
                        </svg>
                        Extracted Links
                    </h4>
                    <div class="space-y-2 text-gray-700 text-sm">
            `;

            if (links.ticket) {
                html += `
                    <div>
                        <span class="font-medium text-gray-600">Ticket:</span>
                        <a href="${links.ticket}" target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:underline break-all ml-1">${links.ticket}</a>
                    </div>
                `;
            }

            if (links.documentation) {
                html += `
                    <div>
                        <span class="font-medium text-gray-600">Documentation:</span>
                        <a href="${links.documentation}" target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:underline break-all ml-1">${links.documentation}</a>
                    </div>
                `;
            }

            if (links.testing) {
                html += `
                    <div>
                        <span class="font-medium text-gray-600">Testing:</span>
                        <a href="${links.testing}" target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:underline break-all ml-1">${links.testing}</a>
                    </div>
                `;
            }

            html += '</div></div>';
            return html;
        }

        // Event listeners
        document.getElementById('validateCommitBtn').addEventListener('click', () => {
            const title = document.getElementById('commitTitle').value;
            const result = checkCompliance(title);
            renderResultBox(result, 'commitResult');
        });

        document.getElementById('validateMRBtn').addEventListener('click', () => {
            const title = document.getElementById('mrTitle').value;
            const description = document.getElementById('mrDescription').value;
            const result = checkCompliance(title);
            const links = extractLinks(description);
            
            renderResultBox(result, 'mrResult');
            
            const linksHtml = renderLinksBox(links);
            if (linksHtml) {
                document.getElementById('mrResult').innerHTML += linksHtml;
            }
        });

        // Example buttons
        document.querySelectorAll('.example-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const example = btn.getAttribute('data-example');
                document.getElementById('commitTitle').value = example;
                document.getElementById('commitResult').innerHTML = '';
            });
        });

        // Use example description
        document.getElementById('useExampleDesc').addEventListener('click', () => {
            const exampleDesc = `Ticket Link: [(Taiga #DATB-456)](https://projects.digitaltelkom.id/project/DATB/us/10353)
Documentation Link: [Figma](https://www.figma.com/design/example)
Testing Link: [https://testing.example.com/result/123]`;
            document.getElementById('mrDescription').value = exampleDesc;
        });

        // Enter key support for commit
        document.getElementById('commitTitle').addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                document.getElementById('validateCommitBtn').click();
            }
        });
    </script>
</body>
</html>